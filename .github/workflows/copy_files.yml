name: Copy Files

on:
  push:
    branches: 
      - develop

jobs:
  build:
    name: Copy main repository files
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@master
      
    - name: Disable Admin Protection
      uses: benjefferies/branch-protection-bot@1.0.2
      if: always() 
      with:
        access-token: ${{ secrets.ACCESS_TOKEN }}
        branch: develop
        enforce_admins: false
      
    - name: Copy main repository files
      id: get-files
      continue-on-error: true
      run: |
        for d in *7Cav*/; do
          if [ -d "${D}"]; then
            if [ $d != "7Cav-Alive-Altis.Altis/" ]
              then
                echo "Starting to process $d"
                ls -d $d/* | grep -v "mission.sqm" | xargs rm -rf
                ls -d ./7Cav-Alive-Altis.Altis/* | grep -v "mission.sqm" | xargs -I '{}' cp -r '{}' ./$d
            fi
          fi
        done
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git checkout develop
        git pull
        git add .
        git commit -m "Copy files from commit: $GITHUB_SHA"
        git push --set-upstream origin develop
        
    - name: Enable Admin Protection
      uses: benjefferies/branch-protection-bot@1.0.2
      if: always() 
      with:
        access-token: ${{ secrets.ACCESS_TOKEN }}
        branch: develop
        enforce_admins: true
